<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <style>
      #loader {
        height: 86vh;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        display: none;
      }
      #filterToast {
        position: fixed;
        bottom: 60px;
        right: 20px;
        z-index: 1055;
        transition: opacity 0.5s ease-in-out;
      }
    </style>
  </head>
  <body>
    <nav class="navbar bg-primary">
      <div class="container-fluid">
        <button
          class="btn text-light fs-5"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasRight"
          aria-controls="offcanvasRight"
        >
          <i class="fa-solid fa-bars"></i>
        </button>
        <form class="d-flex" role="search">
          <input
            class="form-control me-2"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-success" type="submit">Search</button>
        </form>
      </div>
    </nav>
    <div class="container">
      <div
        class="offcanvas offcanvas-start"
        tabindex="-1"
        id="offcanvasRight"
        aria-labelledby="offcanvasRightLabel"
      >
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasRightLabel">
            Apply Filters
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <form method="get" action="">
            <div class="mb-3">
              <label for="weather" class="form-label">Weather</label>
              <select class="form-select" id="weather" name="weather">
                <option value="">Select</option>
                <option value="Clear">Clear</option>
                <option value="Rainy">Rainy</option>
                <option value="Foggy">Foggy</option>
                <option value="Stormy">Stormy</option>
                <option value="Snowy">Snowy</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="road_type" class="form-label">Road Type</label>
              <select class="form-select" id="road_type" name="road_type">
                <option value="">Select</option>
                <option value="City Road">City Road</option>
                <option value="Rural Road">Rural Road</option>
                <option value="Highway">Highway</option>
                <option value="Mountain Road">Mountain Road</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="time_of_day" class="form-label">Time of Day</label>
              <select class="form-select" id="time_of_day" name="time_of_day">
                <option value="">Select</option>
                <option value="Morning">Morning</option>
                <option value="Afternoon">Afternoon</option>
                <option value="Evening">Evening</option>
                <option value="Night">Night</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="vehicle_type" class="form-label">Vehicle Type</label>
              <select name="vehicle_type" id="vehicle_type" class="form-select">
                <option value="">Select</option>
                {% for vehicle_type in vehicle_types %}
                    <option value="{{ vehicle_type }}" {% if vehicle_type == filters.vehicle_type %}selected{% endif %}>{{ vehicle_type }}</option>
                {% endfor %}
              </select>
            </div>
            
            <button type="submit" class="btn btn-primary">Apply Filters</button>
          </form>
        </div>
      </div>
      <div id="loader">
        <img src="/static/charts/Spinner.gif" alt="" />
      </div>
      <div class="content text-center">
        <div class="mt-5">
          <h1 class="text-center">Vehicle Accident Analysis Research</h1>

          <h3 class="text-center">Pie Chart</h3>
          {% load static %}
          <img
            src="/static/charts/weather_conditions_pie_chart.png"
            alt="Weather Conditions Pie Chart"
            data-src="/static/charts/weather_conditions_pie_chart.png"
            class="chart"
          />
        </div>
        <div class="mt-5">
          <h3 class="text-center">Bar Chart</h3>
          {% load static %}
          <img
            src="/static/charts/accidents_by_road_type_bar_chart.png"
            alt="accidents_by_road_type_bar_chart"
            data-src="/static/charts/accidents_by_road_type_bar_chart.png"
            class="chart"
          />
        </div>
        <div class="mt-5">
          <h3 class="text-center">Line Chart</h3>
          {% load static %}
          <img
            src="/static/charts/speed_limit_line_chart.png"
            alt="speed_limit_line_chart"
            data-src="/static/charts/accidents_by_road_type_bar_chart.png"
            class="chart"
          />
        </div>
        <div class="mt-5">
          <h3 class="text-center">Heatmap</h3>
          {% load static %}
          <img
            src="/static/charts/correlation_heatmap.png"
            alt="correlation_heatmap"
          />
        </div>
        <div class="mt-5">
          <h3 class="text-center">Time Count Chart</h3>
          {% load static %}
          <img
            src="/static/charts/accidents_by_time_count_plot.png"
            alt="accidents_by_time_count_plot"
          />
        </div>
        <div class="mt-5">
          <h3 class="text-center">Bar Chart</h3>
          {% load static %}
          <img
            src="/static/charts/alcohol_trends_bar_chart.png"
            alt="driver_age_histogram"
          />
        </div>
      </div>
      <div
        id="filterToast"
        class="toast align-items-center text-bg-primary border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
        style="
          position: fixed;
          bottom: 20px;
          right: 20px;
          z-index: 9999;
          display: none;
        "
      >
        <div class="d-flex">
          <div class="toast-body" id="toastMessage">Filter By</div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <!-- <script>
  document.addEventListener('DOMContentLoaded', function () {
  const filterForm = document.querySelector('form');
  const chartImages = document.querySelectorAll('img.chart');

  filterForm.addEventListener('submit', function (event) {
      event.preventDefault();

      const formData = new FormData(filterForm);
      const queryString = new URLSearchParams(formData).toString();

      fetch(`?${queryString}`)
          .then(response => response.json())
          .then(data => {
              chartImages.forEach(img => {
                  const chartType = img.dataset.src;
                  img.src = `${chartType}?t=${Date.now()}`;
              });
          })
          .catch(error => console.error('Error fetching updated charts:', error));
  });
});
</script> -->

    <!-- <script>
      document.addEventListener("DOMContentLoaded", function () {
        const filterForm = document.querySelector("form");
        const pieChart = document.getElementById("weather"); // Get the pie chart element
        const chartImages = document.querySelectorAll("img.chart"); // Get all chart images
        const loader = document.getElementById("loader"); // Get the loader element

        filterForm.addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the form from submitting traditionally

          loader.style.display = "block";

          const formData = new FormData(filterForm); // Get the form data
          const queryString = new URLSearchParams(formData).toString(); // Convert form data to query string

          fetch(`?${queryString}`) // Send the GET request with the form data
            .then((response) => response.json())
            .then((data) => {
              // Check if the weather filter is applied (and if it's not an empty value)
              const weather = formData.get("weather");
              if (weather) {
                pieChart.style.display = "none"; // Hide the pie chart if the weather filter is applied
              } else {
                pieChart.style.display = "block"; // Show the pie chart if no weather filter is applied
              }

              // Optionally update other charts if needed
              chartImages.forEach((img) => {
                const chartType = img.dataset.src;
                img.src = `${chartType}?t=${Date.now()}`; // Add a cache-busting query parameter to force reload
              });
            })
            .catch((error) =>
              console.error("Error fetching updated charts:", error)
            )
            .finally(() => {
              loader.style.display = "none"; // Hide the loader after data fetching is complete
            });
        });
      });
    </script> -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
  console.log("Document is loaded."); // Debugging message

  const filterForm = document.querySelector("form");
  const toast = document.getElementById("filterToast");
  const toastMessage = document.getElementById("toastMessage");

  if (!filterForm || !toast || !toastMessage) {
    console.error("Form, toast, or toastMessage not found in the DOM.");
    return;
  }

  filterForm.addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent the form from submitting traditionally
    console.log("Form submitted."); // Debugging message

    const formData = new FormData(filterForm); // Get the form data
    const queryString = new URLSearchParams(formData).toString(); // Convert form data to query string
    console.log("Form Data:", queryString); // Debugging message

    // Get the applied filter values
    const weather = formData.get("weather");
    const roadType = formData.get("road_type");
    const timeOfDay = formData.get("time_of_day");

    // Prepare the filter string
    let filterText = "Filter By: ";
    if (weather) {
      filterText += `Weather: ${weather}, `;
    }
    if (roadType) {
      filterText += `Road Type: ${roadType}, `;
    }
    if (timeOfDay) {
      filterText += `Time of Day: ${timeOfDay}, `;
    }
    filterText = filterText.slice(0, -2); // Remove the last comma

    console.log("Filter Text:", filterText); // Debugging message

    // Update the toast
    toastMessage.textContent = filterText;
    toast.style.display = "block"; // Show the toast
    console.log("Toast updated and displayed."); // Debugging message

    setTimeout(() => {
      toast.style.display = "none"; // Hide the toast after 3 seconds
    }, 3000);
  });
});

    </script>
  </body>
</html>
